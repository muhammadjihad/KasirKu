<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../statics/vendor/bootstrap/bootstrap.css">
    <title>KasirKu</title>
    <style>
        .delete-list-produk{
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="d-flex flex-row bd-highlight mb-3 p-3 bg-light justify-content-around main-menu">
        <div class="p-2 bd-highlight w-100">
            <div class="btn btn-primary w-100 tombol" content="menu-utama">
                <img src="../assets/images/wireframe.svg" height="25px" alt="">
                <br>
                <span>Menu Utama</span>
            </div>
        </div>
        <div class="p-2 bd-highlight w-100 ">
            <div class="btn btn-outline-primary w-100 tombol" content="supplier">
                <img src="../assets/images/supplier.svg" height="25px" alt="">
                <br>
                <span>Supplier</span>
            </div>
        </div>
        <div class="p-2 bd-highlight w-100 ">
            <div class="btn btn-outline-primary w-100 tombol" content="barang">
                <img src="../assets/images/package.svg" height="25px" alt="">
                <br>
                <span>Barang</span>
            </div>
        </div>
        <div class="p-2 bd-highlight w-100 ">
            <button class="btn btn-small btn-outline-primary w-100 tombol" content="pelanggan">
                <img src="../assets/images/people.svg" height="25px" alt="">
                <br>
                <span>Pelanggan</span>
            </button>
        </div>
        <div class="p-2 bd-highlight w-100 ">
            <button class="btn btn-small btn-outline-primary w-100 tombol" content="penjualan">
                <img src="../assets/images/sold.svg" height="25px" alt="">
                <br>
                <span>Penjualan</span>
            </button>
        </div>
    </div>
    <div id="content">

    </div>
    <!-- <button id="clicked"></button> -->

    <script>if (typeof module === 'object') {window.module = module; module = undefined;}
    </script>
    <script src="../statics/vendor/jquery/jquery.js"></script>
    <script src="../statics/vendor/popper/popper.js"></script>
    <script src="../statics/vendor/bootstrap/bootstrap.js"></script>
    <script src="../statics/vendor/chartjs/chartjs.js"></script>
    <!-- Insert this line after script imports -->
    <script>if (window.module) module = window.module;</script>
    <script>
        const { ipcRenderer }=require("electron");
        // const CHANNEL_NAME="data";
        // ipcRenderer.on(CHANNEL_NAME,(event,data)=>{
        //     console.log(data);
        // });
        // const clickButton=()=>{
        //     let message="ping";

        //     ipcRenderer.send(CHANNEL_NAME,message);
        // }
        // document.getElementById("clicked").addEventListener("click",()=>{
        //     clickButton();
        // });
    </script>
    <script>
        // const mainMenu=document.querySelector(".main-menu");
        // const tombol=document.querySelectorAll(".tombol");
        // var i=1;
        // for(tom of tombol){
        //     tom.addEventListener("click",()=>{
        //         console.log("KE")
        //     })
        // }
        var resp;
        var params;
        var supplierParams;
        var contentRender="";
        var content="menu-utama";
        const tombols=$(".tombol");
        tombols.each((i,el)=>{
            el.addEventListener("click",(ev)=>{
                contentTemp=el.getAttribute("content");
                tombols.removeClass("btn-primary")
                tombols.removeClass("btn-outline-primary")
                tombols.addClass("btn-outline-primary")
                el.classList="btn btn-small btn-primary w-100 tombol"
                renderContent(contentTemp);
            });
        });

        var channelName=""
        var ctx;
        
        var opsi;
        var opsiGrosir;

        function renderUlang(content){

            $("#tambah-kategori-grosir-submit").click(ev=>{
                const value=$("#tambah-kategori-grosir-value").val();
                var resp=ipcRenderer.sendSync("tambah-kategori-grosir",{
                    "nama_jenis":value
                });
                if(resp.inserted){
                    $('.modal-backdrop').remove();
                    $("#tambah-supplier").modal("hide");
                    renderContent("barang")
                }
            })

            $(".submit-edit-barang").click(ev=>{
                const grosirElements=ev.target.parentElement.parentElement.children[1].children[0].children[0].children[4].children;
                // console.log(grosirElements);
                var dataGrosir=Array();
                for(grosir of grosirElements){
                    // console.log(grosir);
                    var hargaGrosir=grosir.children[0].children[1].children;
                    var obj={
                        "jenis_id":grosir.getAttribute("id_grosir"),
                        "grosir":Array()
                    }
                    for(harga of hargaGrosir){
                        obj["grosir"].push({
                            "kuantitas":harga.children[1].children[0].value,
                            "harga_satuan":harga.children[2].children[0].value
                        });
                    }
                    dataGrosir.push(obj)
                }
                const forms=ev.target.parentElement.previousElementSibling.children[0].children[0];
                const namaBarang=forms.children[0].children[0].value;
                const kodeBarang=forms.children[1].children[0].value;
                const hargaSatuan=forms.children[2].children[0].children[1].value;
                const hargaBeliBarang=forms.children[3].children[0].children[1].value;

                // tambahan harga grosir;
                var tambahan=ev.target.parentElement.previousElementSibling.children;
                // console.log(tambahan.children[5].children);
                tambahan=tambahan[0].children[0].children[5].children;
                var grosirTambahan=Array();
                for(tambah of tambahan){
                    var d={
                        "jenis":tambah.children[0].getAttribute("nilai"),
                        "kuantitas":tambah.children[1].getAttribute("nilai"),
                        "harga":tambah.children[2].getAttribute("nilai"),
                    }
                    grosirTambahan.push(d);
                }
            

                // console.log(editGrosir);

                const data={
                    idBarang:ev.target.parentElement.getAttribute("id_barang"),
                    namaBarang:namaBarang,
                    kodeBarang:kodeBarang,
                    hargaSatuan:hargaSatuan,
                    hargaBeliBarang:hargaBeliBarang,
                    grosir:dataGrosir,
                    grosirTambahan:grosirTambahan
                }
                console.log(data);
                var resp=ipcRenderer.sendSync("edit-barang",data);
                window.location.reload();
            });

            $(".hapus-harga-grosir").click(ev=>{
                ev.target.parentElement.parentElement.remove()
            });

            $(".delete-list-produk").click(ev=>{
                ev.target.parentElement.parentElement.parentElement.parentElement.remove();
                setTotalHarga();
            });

            const subMenu=$(".sub-menu");
            console.log(subMenu)
            subMenu.each((i,el)=>{
                el.addEventListener("click",(event)=>{    
                    subMenu.removeClass("btn-primary");
                    subMenu.removeClass("btn-outline-primary");
                    subMenu.addClass("btn-outline-primary")
                    el.classList="btn-primary p-2 rounded-right sub-menu"
                })
            });
            const cariBarang=$("#cari-barang-submit");
            cariBarang.click(event=>{
                params={
                    "search":$("#cari-barang").val()
                }
                renderContent(content)
            });
            $("#cari-barang").keypress(ev=>{
                var keyCode=(ev.keyCode ? ev.keyCode:ev.which);
                if(keyCode == "13"){
                    params={
                        "search":$("#cari-barang").val()
                    }
                    renderContent(content)
                }
            });
            $(".hapus-produk").each((i,el)=>{
                el.addEventListener("click",ev=>{
                    ipcRenderer.sendSync("barang-delete",{"id":el.getAttribute('val')});
                    renderUlang("barang");
                    el.parentElement.parentElement.innerHTML="";
                })
            });
            if(content === "penjualan"){
                renderGraph();
            }

            $("#submit-buat-supplier").click(ev=>{
                ev.preventDefault();
                const alamatSupplier=$("#alamat-supplier").val();
                const namaSupplier=$("#nama-supplier").val();
                const kontakSupplier=$("#kontak-supplier").val();
                const data={
                    "alamatSupplier":alamatSupplier,
                    "namaSupplier":namaSupplier,
                    "kontakSupplier":kontakSupplier
                }
                ipcRenderer.sendSync("buat-supplier",data);
                // contentRender=renderContent("supplier");
                // window.location.reload();
                
                $('.modal-backdrop').remove();
                $("#tambah-supplier").modal("hide");
                renderContent("supplier")
            })

            $("#cari-supplier-submit").click(ev=>{
                supplierParams={
                    "search":$("#cari-supplier").val()
                }
                renderContent(content);
            });
            $("#cari-supplier").keypress(ev=>{
                var keyCode=(ev.keyCode ? ev.keyCode:ev.which);
                if(keyCode == "13"){
                    supplierParams={
                        "search":$("#cari-supplier").val()
                    }
                    renderContent(content)
                }
            });

            $("#buat-transaksi").click(ev=>{
                contentRender=menuUtamaRender({
                    "section":"buat-transaksi"
                });
                $("#content").html(contentRender);
                renderUlang(content);
            });

            $("#list-transaksi").click(ev=>{
                renderContent(content);
                renderUlang(content);
                // contentRender=menuUtamaRender();
                // $("#content").html(contentRender);
            });

            $(".dropdown-menu button.dropdown-item").click(ev=>{
                ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
                ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                console.log(ev.target.parentElement.parentElement.parentElement);
                const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].value ?? 0;
                    // console.log(produkId)
                getHarga(ev,produkId,grosirId,kuantitas);
                $(".dropdown-menu button.dropdown-item").click(ev=>{
                    ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
                    ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                    console.log(ev.target.parentElement.parentElement.parentElement);
                    const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                    const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                    const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
                        // console.log(produkId)
                    getHarga(ev,produkId,grosirId,kuantitas);
                    // console.log(produkId)
                });
                // console.log(produkId)
            });

            $("input.kuantitas").keyup(ev=>{
                ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.value);
                // console.log(ev.target.parentElement.parentElement.parentElement.parentElement);
                const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                // console.log(produkId)
                getHarga(ev,produkId,grosirId,ev.target.value);
            });

            $("#submit-buat-belanja").click(ev=>{
                ev.preventDefault()
                var totalHarga=0;
                var belanja=Array();
                const totalProduk=$(".produk");
                totalProduk.each((i,produk)=>{
                    totalHarga+=parseInt(produk.getAttribute("sub-total"));
                    var produkId=produk.children[0].getAttribute("nilai");
                    var dataBelanja;
                    if(produkId == 0){
                        dataBelanja={
                            produkId:null,
                            grosirId:null,
                            kuantitas:null,
                            subTotal:produk.getAttribute("sub-total"),
                            namaProduk:produk.children[0].getAttribute("nilai_opt")
                        }
                    } else {
                        dataBelanja={
                            produkId:produk.children[0].getAttribute("nilai"),
                            grosirId:produk.children[1].getAttribute("nilai"),
                            kuantitas:produk.children[2].getAttribute("nilai"),
                            subTotal:produk.getAttribute("sub-total"),
                            namaProduk:null
                        }
                    }
                    belanja.push(dataBelanja);
                });
                var sendData={
                    "belanja":belanja,
                    "total_harga":totalHarga
                }
                if(totalHarga > 0){
                    var resp=ipcRenderer.sendSync("transaksi-service",sendData);
                    if(resp.inserted){
                        window.location.reload();
                    }
                }
            });

            $("#tambah-harga-grosir").click(ev=>{
                ev.preventDefault();
                var grosirElement=renderTambahHargaGrosir()
                $("#form-tambah-list-harga-grosir").append(grosirElement);
                $(".dropdown-menu button.dropdown-item").click(ev=>{
                    ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                    ev.target.parentElement.parentElement.parentElement.parentElement.children[0].setAttribute("nilai",ev.target.getAttribute("idbarang"));
                });
                $(".tambah-grosir-minimum-pembelian").keyup(ev=>{
                    ev.target.parentElement.parentElement.parentElement.parentElement.children[1].setAttribute("nilai",ev.target.value);
                })
                $(".tambah-grosir-harga-grosir").keyup(ev=>{
                    console.log(ev.target.parentElement.parentElement.parentElement);
                    ev.target.parentElement.parentElement.parentElement.parentElement.children[2].setAttribute("nilai",ev.target.value);
                });
            });

            // $("#tambah-edit-harga-grosir").click(ev=>{
            //     ev.preventDefault();
            //     var grosirElement=renderTambahHargaGrosir()
            //     $("#form-edit-barang").append(grosirElement);
            //     $(".dropdown-menu button.dropdown-item").click(ev=>{
            //         ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
            //         ev.target.parentElement.parentElement.parentElement.parentElement.children[0].setAttribute("nilai",ev.target.getAttribute("idbarang"));
            //     });
            //     $(".tambah-grosir-minimum-pembelian").keyup(ev=>{
            //         ev.target.parentElement.parentElement.parentElement.parentElement.children[1].setAttribute("nilai",ev.target.value);
            //     })
            //     $(".tambah-grosir-harga-grosir").keyup(ev=>{
            //         console.log(ev.target.parentElement.parentElement.parentElement);
            //         ev.target.parentElement.parentElement.parentElement.parentElement.children[2].setAttribute("nilai",ev.target.value);
            //     });
            // });

            $(".tutup-history-produk-modal").click(ev=>{
                const targetParent=ev.target.parentElement.parentElement.parentElement.parentElement;
                $("#"+targetParent.getAttribute("id")).modal("hide")
                // console.log(targetParent)
            })

            $(".tambah-edit-harga-grosir").click(ev=>{
                ev.preventDefault();
                var grosirElement=renderTambahHargaGrosir()
                // ev.target.append(grosirElement);
                ev.target.parentElement.children[0].children[5].innerHTML+=grosirElement
                $(".dropdown-menu button.dropdown-item").click(ev=>{
                    ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                    ev.target.parentElement.parentElement.parentElement.parentElement.children[0].setAttribute("nilai",ev.target.getAttribute("idbarang"));
                });
                $(".tambah-grosir-minimum-pembelian").keyup(ev=>{
                    ev.target.parentElement.parentElement.parentElement.parentElement.children[1].setAttribute("nilai",ev.target.value);
                })
                $(".tambah-grosir-harga-grosir").keyup(ev=>{
                    console.log(ev.target.parentElement.parentElement.parentElement);
                    ev.target.parentElement.parentElement.parentElement.parentElement.children[2].setAttribute("nilai",ev.target.value);
                });
            });

            $("#submit-tambah-list-produk").click(ev=>{
                var hargaGrosir=$("#form-tambah-list-harga-grosir").children();
                const namaProduk=$("#tambah-produk-nama-produk").val();
                const kodeProduk=$("#tambah-produk-kode-produk").val();
                const hargaSatuan=$("#tambah-produk-harga-satuan").val();
                const hargaBeli=$("#tambah-produk-harga-beli").val();
                var dataGrosir=Array();
                hargaGrosir.each((i,el)=>{
                    var data={
                        grosirId:el.children[0].getAttribute("nilai"),
                        minimumPembelian:el.children[1].getAttribute("nilai"),
                        hargaGrosir:el.children[2].getAttribute("nilai")
                    }
                    dataGrosir.push(data);
                });
                var data={
                    namaProduk:namaProduk,
                    kodeProduk:kodeProduk,
                    hargaSatuan:hargaSatuan,
                    hargaBeli:hargaBeli,
                    hargaGrosir:dataGrosir
                }
                console.log(data);
                var resp=ipcRenderer.sendSync("tambah-list-barang",data);
                if(resp.inserted){
                    $('.modal-backdrop').remove();
                    $("#tambah-list-produk").modal("hide");
                    renderContent("barang");
                }
            });

            function cariSemuaBarang(){
                $(".cari-semua-barang").keypress(ev=>{
                ev.preventDefault();
                var keyCode=(ev.keyCode ? ev.keyCode:ev.which);
                if(keyCode == "13"){
                    params={
                        "search":ev.target.value
                    }
                    var semuaBarang=ipcRenderer.sendSync("semua-barang",params);
                    opsi=""
                    for(barang of semuaBarang.data){
                        opsi+=`<button class="dropdown-item" type="button" idbarang="${barang.id}" id="barang-${barang.id}">${barang.nama}</button>`
                    }
                    
                    var nextNode=ev.target.nextElementSibling;
                    var twoNext=nextNode != undefined ? ev.target.nextElementSibling.nextElementSibling : null;
                    while(nextNode!=null){
                        nextNode.remove();
                        nextNode=twoNext;
                        twoNext=twoNext == null ? null : twoNext.nextElementSibling;
                    }
                    console.log(ev.target.parentElement);
                    ev.target.parentElement.innerHTML+=opsi;
                    semuaBarang=ipcRenderer.sendSync("semua-barang");
                    opsi=""
                    for(barang of semuaBarang.data){
                        opsi+=`<button class="dropdown-item" type="button" idbarang="${barang.id}" id="barang-${barang.id}">${barang.nama}</button>`
                    }
                    $(".dropdown-menu button.dropdown-item").click(ev=>{
                        ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
                        ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                        console.log(ev.target.parentElement.parentElement.parentElement);
                        const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                        const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                        const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
                            // console.log(produkId)
                        getHarga(ev,produkId,grosirId,kuantitas);
                        $(".dropdown-menu button.dropdown-item").click(ev=>{
                            ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
                            ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                            console.log(ev.target.parentElement.parentElement.parentElement);
                            const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                            const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                            const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
                                // console.log(produkId)
                            getHarga(ev,produkId,grosirId,kuantitas);
                            // console.log(produkId)
                        });
                    });

                    $("input.kuantitas").keyup(ev=>{
                        // console.log(ev.target.parentElement.parentElement.parentElement.parentElement);
                        ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.value);
                        const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                        const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                        // console.log(produkId)
                        getHarga(ev,produkId,grosirId,ev.target.value);
                    });
                    cariSemuaBarang();
                } else {
                    ev.target.value+=String.fromCharCode(ev.which);
                }
            });
            }
            cariSemuaBarang();  
            // $(".cari-semua-barang").keypress(ev=>{
            //     cariSemuaBarang()
                // ev.preventDefault();
                // var keyCode=(ev.keyCode ? ev.keyCode:ev.which);
                // if(keyCode == "13"){
                //     params={
                //         "search":ev.target.value
                //     }
                //     var semuaBarang=ipcRenderer.sendSync("semua-barang",params);
                //     opsi=""
                //     for(barang of semuaBarang.data){
                //         opsi+=`<button class="dropdown-item" type="button" idbarang="${barang.id}" id="barang-${barang.id}">${barang.nama}</button>`
                //     }
                //     var nextNode=ev.target.nextElementSibling;
                //     var twoNext=nextNode != undefined ? ev.target.nextElementSibling.nextElementSibling : null;
                //     while(nextNode!=null){
                //         nextNode.remove();
                //         nextNode=twoNext;
                //         twoNext=twoNext == null ? null : twoNext.nextElementSibling;
                //     }
                //     console.log(ev.target.parentElement);
                //     ev.target.parentElement.innerHTML+=opsi;
                //     semuaBarang=ipcRenderer.sendSync("semua-barang");
                //     opsi=""
                //     for(barang of semuaBarang.data){
                //         opsi+=`<button class="dropdown-item" type="button" idbarang="${barang.id}" id="barang-${barang.id}">${barang.nama}</button>`
                //     }
                    
                //     $(".dropdown-menu button.dropdown-item").click(ev=>{
                //         ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
                //         ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                //         console.log(ev.target.parentElement.parentElement.parentElement);
                //         const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                //         const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                //         const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
                //             // console.log(produkId)
                //         getHarga(ev,produkId,grosirId,kuantitas);
                //         $(".dropdown-menu button.dropdown-item").click(ev=>{
                //             ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
                //             ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                //             console.log(ev.target.parentElement.parentElement.parentElement);
                //             const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                //             const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                //             const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
                //                 // console.log(produkId)
                //             getHarga(ev,produkId,grosirId,kuantitas);
                //             // console.log(produkId)
                //         });
                //         // console.log(produkId)
                //     });

                //     $("input.kuantitas").keyup(ev=>{
                //         // console.log(ev.target.parentElement.parentElement.parentElement.parentElement);
                //         ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.value);
                //         const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                //         const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                //         // console.log(produkId)
                //         getHarga(ev,produkId,grosirId,ev.target.value);
                //     });
                // } else {
                //     ev.target.value+=String.fromCharCode(ev.which);
                // }
            // });

            $(".edit-utang-piutang").click(ev=>{
                ev.preventDefault();
                const utang=ev.target.parentElement.children[0].children[1].value
                const piutang=ev.target.parentElement.children[1].children[1].value
                const supplier_id=ev.target.getAttribute("id_value")
                data={
                    "supplier_id":supplier_id,
                    "utang":utang,
                    "piutang":piutang
                }
                console.log(data)
                var editUtang=ipcRenderer.sendSync("edit-utang-piutang",data)
                if(editUtang.updated){
                    $('.modal-backdrop').remove();
                    $("#edit-utang-piutang-"+supplier_id).modal("hide");
                    renderContent("supplier")
                }
            })

            $('#tambah-list-produk').on('hidden.bs.modal', function (e) {
                $(this)
                    .find("input,textarea,select")
                    .val('')
                    .end()
                    .find("input[type=checkbox], input[type=radio]")
                    .prop("checked", "")
                    .end();
            });
            $('#submit-tambah-list-produk').on('hidden.bs.modal', function (e) {
                $(this)
                    .find("input,textarea,select")
                    .val('')
                    .end()
                    .find("input[type=checkbox], input[type=radio]")
                    .prop("checked", "")
                    .end();
            });
            $(".submit-edit-barang").click(ev=>{
                // const forms=$("#form-edit-barang").children();
                // const data={
                //     namaBarang:forms[0].children[0].value,
                //     kodeBarang:forms[1].children[0].value
                // }
                // var resp=ipcRenderer.sendSync("edit-barang",data);
                // console.log(resp);
            });

            $("#tambah-produk-manual").click(ev=>{
                const appending=`<div class="container text-center row produk p-1">
                    <div class="col-sm-6" nilai=0>
                        <div>
                            <div>
                                <input type="text" class="form-control nama-produk" id="nama-supplier" aria-describedby="emailHelp" placeholder="Nama Produk dan jumlahnya (cth: plastik 2 pack)">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div>
                            <div>
                                <input type="number" class="form-control sub-harga" id="nama-supplier" aria-describedby="emailHelp" placeholder="Sub Harga">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <small></small>
                    </div>
                    <div class="col-sm-1">
                        <div>
                            <div>
                                <small class="delete-list-produk" style="color:red;">X</small>
                            </div>
                        </div>
                    </div>
                </div>`
                $("#forms-input").append(appending);
                $(".nama-produk").keyup(ev=>{
                    ev.target.parentElement.parentElement.parentElement.setAttribute("nilai_opt",ev.target.value);
                })
                $(".sub-harga").keyup(ev=>{
                    ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.value);
                    // console.log(produkId)
                    getHarga(ev,0,0,ev.target.value);
                    // console.log(produkId)
                });

                $(".delete-list-produk").click(ev=>{
                    ev.target.parentElement.parentElement.parentElement.parentElement.remove();
                    setTotalHarga();
                });

                // $("input.kuantitas").keyup(ev=>{
                //     // console.log(ev.target.parentElement.parentElement.parentElement.parentElement);
                //     ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.value);
                //     const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                //     const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                //     // console.log(produkId)
                //     getHarga(ev,produkId,grosirId,ev.target.value);
                // });


                // cariSemuaBarang();
            });

            $("#tambah-produk").click(ev=>{
                
                ev.preventDefault();
                // console.log($("#forms-input").children().add("test"))    
                const appending=`<div class="container text-center row produk p-1">
                    <div class="col-sm-3">
                        <div class="dropdown d-inline-block">
                            <button class="btn btn-outline-primary dropdown-toggle d-inline-block" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Produk
                            </button>
                            <div class="dropdown-menu" style="max-height:50vh;overflow:scroll;" aria-labelledby="dropdownMenu2">
                                <input type="text" class="form-control cari cari-semua-barang" aria-describedby="emailHelp" placeholder="Cari Barang ..">
                                ${opsi}
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Satuan Harga
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                ${semuaGrosir}
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div>
                            <div>
                                <input type="number" class="form-control kuantitas" id="nama-supplier" aria-describedby="emailHelp" placeholder="Kuantitas">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <small></small>
                    </div>
                    <div class="col-sm-1">
                        <div>
                                            <div>
                                                <small class="delete-list-produk" style="color:red;">X</small>
                                            </div>
                                        </div>
                                    </div>
                </div>`
                $("#forms-input").append(appending);
                // renderUlang(content)
                $(".dropdown-menu button.dropdown-item").click(ev=>{
                    ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
                    ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                    console.log(ev.target.parentElement.parentElement.parentElement);
                    const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                    const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                    const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
                        // console.log(produkId)
                    getHarga(ev,produkId,grosirId,kuantitas);
                    $(".dropdown-menu button.dropdown-item").click(ev=>{
                        ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
                        ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
                        console.log(ev.target.parentElement.parentElement.parentElement);
                        const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                        const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                        const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
                            // console.log(produkId)
                        getHarga(ev,produkId,grosirId,kuantitas);
                        // console.log(produkId)
                    });
                    // console.log(produkId)
                });

                $(".delete-list-produk").click(ev=>{
                    ev.target.parentElement.parentElement.parentElement.parentElement.remove();
                    setTotalHarga();
                });

                $("input.kuantitas").keyup(ev=>{
                    // console.log(ev.target.parentElement.parentElement.parentElement.parentElement);
                    ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.value);
                    const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
                    const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
                    // console.log(produkId)
                    getHarga(ev,produkId,grosirId,ev.target.value);
                });


                cariSemuaBarang();
                // $(".cari-semua-barang").keypress(ev=>{
                //     // cariSemuaBarang();  
                // });

            })

        }

        // $(".cari-semua-barang").keypress(ev=>{
        //             var keyCode=(ev.keyCode ? ev.keyCode:ev.which);
        //             if(keyCode == "13"){
        //                 params={
        //                     "search":ev.target.value
        //                 }
        //                 ev.preventDefault();
        //                 var semuaBarang=ipcRenderer.sendSync("semua-barang",params);
        //                 opsi=""
        //                 for(barang of semuaBarang.data){
        //                     opsi+=`<button class="dropdown-item" type="button" idbarang="${barang.id}" id="barang-${barang.id}">${barang.nama}</button>`
        //                 }
        //                 var nextNode=ev.target.nextElementSibling;
        //                 var twoNext=nextNode != undefined ? ev.target.nextElementSibling.nextElementSibling : null;
        //                 while(nextNode!=null){
        //                     nextNode.remove();
        //                     nextNode=twoNext;
        //                     twoNext=twoNext == null ? null : twoNext.nextElementSibling;
        //                 }
        //                 console.log(ev.target.parentElement);
        //                 ev.target.parentElement.innerHTML+=opsi;
        //                 semuaBarang=ipcRenderer.sendSync("semua-barang");
        //                 opsi=""
        //                 for(barang of semuaBarang.data){
        //                     opsi+=`<button class="dropdown-item" type="button" idbarang="${barang.id}" id="barang-${barang.id}">${barang.nama}</button>`
        //                 }
        //                 $(".dropdown-menu button.dropdown-item").click(ev=>{
        //                     ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
        //                     ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
        //                     console.log(ev.target.parentElement.parentElement.parentElement);
        //                     const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
        //                     const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
        //                     const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
        //                         // console.log(produkId)
        //                     getHarga(ev,produkId,grosirId,kuantitas);
        //                     $(".dropdown-menu button.dropdown-item").click(ev=>{
        //                         ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.getAttribute("idbarang"));
        //                         ev.target.parentElement.parentElement.children[0].innerHTML=ev.target.innerHTML;
        //                         console.log(ev.target.parentElement.parentElement.parentElement);
        //                         const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
        //                         const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
        //                         const kuantitas=ev.target.parentElement.parentElement.parentElement.parentElement.children[2].getAttribute("nilai");
        //                             // console.log(produkId)
        //                         getHarga(ev,produkId,grosirId,kuantitas);
        //                         // console.log(produkId)
        //                     });
        //                     // console.log(produkId)
        //                 });

        //                 $("input.kuantitas").keyup(ev=>{
        //                     // console.log(ev.target.parentElement.parentElement.parentElement.parentElement);
        //                     ev.target.parentElement.parentElement.parentElement.setAttribute("nilai",ev.target.value);
        //                     const produkId=ev.target.parentElement.parentElement.parentElement.parentElement.children[0].getAttribute("nilai");
        //                     const grosirId=ev.target.parentElement.parentElement.parentElement.parentElement.children[1].getAttribute("nilai");
        //                     // console.log(produkId)
        //                     getHarga(ev,produkId,grosirId,ev.target.value);
        //                 });
                        
        //             }
        //         });

        function setTotalHarga(){
            var totalHarga=0;
            const totalProduk=$(".produk");
            totalProduk.each((i,produk)=>{
                totalHarga+=parseInt(produk.getAttribute("sub-total"));
            });
            totalHarga=totalHarga.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            $("#total-harga").html(`
                <h3>Total Belanja : Rp ${totalHarga}</h3>
            `)
        }

        function getHarga(node,produkId,grosirId,kuantitas){
            data={
                produkId:produkId,
                grosirId:grosirId,
                kuantitas:kuantitas
            }
            console.log(data);
            if(produkId == 0){
                const harga=node.target.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                node.target.parentElement.parentElement.parentElement.parentElement.setAttribute("sub-total",node.target.value)
                node.target.parentElement.parentElement.parentElement.parentElement.children[2].innerHTML=`<small class="text-bold">Rp, ${harga}</small>`;
                setTotalHarga();
            }else{
                var resp=ipcRenderer.sendSync("get-harga",data);
                if(resp.data.length>0){
                    const harga=(resp.data[0].harga*kuantitas).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                    node.target.parentElement.parentElement.parentElement.parentElement.setAttribute("sub-total",resp.data[0].harga*kuantitas)
                    node.target.parentElement.parentElement.parentElement.parentElement.children[3].innerHTML=`<small class="text-bold">Rp, ${harga}</small>`;
                    setTotalHarga();
                }
            }
            // console.log(node.target);
        }

        function renderGraph(){
            var resp=ipcRenderer.sendSync("penjualan",{});
            console.log("DARI RENDER GRAPH")
            console.log(resp);
            const ctx=document.getElementById("penjualanChart").getContext("2d");
            const penjualanChart=new Chart(ctx,{
                type: 'bar',
                data: {
                    labels: resp.data.tanggal,
                    datasets: [{
                        label: 'Jumlah Penjualan',
                        data: resp.data.total_per_hari,
                        backgroundColor:'rgba(255, 100, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 0.2)',
                        borderWidth: 1,
                    }]
                },
                options: {
                    scaleLabel:function(label){return  '$' + label.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");},
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                callback: function(value, index, values) {
                                    if(parseInt(value) >= 1000){
                                        return 'Rp' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                    } else {
                                        return 'Rp' + value;
                                    }
                                }
                            }
                        }]
                    }
                }
            });
        }

        var contentData;
        var totalHarga=0;
        var itemBarang=0;

        var menu=["menu-utama","supplier","barang","pelanggan","pembelian","penjualan"];

        menu.forEach(el=>{
            ipcRenderer.on(el,(ev,data)=>{
                contentData=data;
            })
        })
        function menuUtamaRender(data){
            res=''
            loop=""
            if(data.section === "buat-transaksi"){
                var semuaBarang=ipcRenderer.sendSync("semua-barang");
                var semuaGrosirs=ipcRenderer.sendSync("semua-grosir");
                opsi=""
                semuaGrosir=""
                for(barang of semuaBarang.data){
                    opsi+=`<button class="dropdown-item" type="button" idbarang="${barang.id}" id="barang-${barang.id}">${barang.nama}</button>`
                }
                // console.log(semuaGrosirs)
                for(grosir of semuaGrosirs.data){
                    semuaGrosir+=`<button class="dropdown-item" type="button" idbarang="${grosir.id}" id="grosir-${grosir.id}">${grosir.nama_jenis}</button>`
                }
                res=`
                <div class="d-flex bd-highlight">
                    <div class="bd-highlight">
                        <div type="button" style="width:250px;" class="text-center">
                            <div class="btn-outline-primary p-2 rounded-right sub-menu" id="list-transaksi">Transaksi Terkahir</div>
                        </div>
                        <div type="button" style="width:250px;" class="text-center">
                            <div class="btn-primary border p-2 rounded-right sub-menu" id="buat-transaksi">Buat Transaksi</div>
                        </div>
                    </div>
                    <div class="pr-2 pl-2 flex-fill bd-highlight">
                        <form id="transaksi-form">
                            <div id="forms-input">
                                <div class="container text-center row produk p-1">
                                    <div class="col-sm-3">
                                        <div class="dropdown">
                                            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="item-barang-${itemBarang}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                Produk
                                            </button>
                                            <div class="dropdown-menu" style="max-height:50vh;overflow:scroll;" aria-labelledby="dropdownMenu2">
                                                <input type="text" class="form-control cari-semua-barang" aria-describedby="cari-barang" placeholder="Cari Barang ..">
                                                ${opsi}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="dropdown">
                                            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                Satuan Harga
                                            </button>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                                ${semuaGrosir}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div>
                                            <div>
                                                <input type="number" class="form-control kuantitas" id="nama-supplier" aria-describedby="emailHelp" placeholder="Kuantitas">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-2">
                                        <small></small>
                                    </div>
                                    <div class="col-sm-1">
                                        <div>
                                            <div>
                                                <small class="delete-list-produk" style="color:red;">X</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="container m-5 text-center">
                                <div id="tambah-produk" class="btn btn-primary">Tambah Produk dari Data Barang</div>
                                <div id="tambah-produk-manual" class="btn btn-secondary">Tambah Produk Manual</div>
                            </div>
                            <hr/>
                            <div class="container row">
                                <h3 class="col-sm-10" id="total-harga">Total Belanja : Rp ${totalHarga}</h3>
                                <button type="submit" class="btn btn-success col-sm-2" id="submit-buat-belanja">Konfirmasi</button>
                            </div>
                        </form>
                    </div>
                </div>
                `
            } else {
                for(obj of data.data){
                    dataBelanja="";
                    hargaBarang=obj.total_harga.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")
                    for(dataBarang of obj.barang){
                        subTotal=dataBarang.sub_total ? "Rp"+dataBarang.sub_total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : null
                        dataBelanja+=`
                        <div class="container">
                            <small>${dataBarang.nama_barang}</small>
                            <small>${dataBarang.kuantitas} x </small>
                            <small>${dataBarang.nama_jenis}</small>
                            <small>${subTotal}</small>
                        </div>
                        `
                    }
                    console.log(obj)
                    loop+=`
                        <tr>
                            <td scope="row">${obj.id}</td>
                            <td>${obj.waktu_order}</td>
                            <td>
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#transaksi-${obj.id}" data-whatever="${obj.id}">Lihat</button>
                                <div class="modal fade" id="transaksi-${obj.id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">${obj.waktu_order}</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        ${dataBelanja}
                                        <hr/>
                                        <h3>Total Belanja : Rp${hargaBarang}</h3>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                                    </div>
                                    </div>
                                </div>
                                </div>
                            </td>
                        </tr>
                    `
                }
                res+=`<table class="table">
                    <thead>
                        <tr>
                            <th scope="col">id</th>
                            <th scope="col">waktu transaksi</th>
                            <th scope="col">detail</th>
                        </tr>
                    </thead>
                    <tbody>${loop}</tbody>
                    </table>
                    `
                res=`
                    <div class="d-flex bd-highlight">
                        <div class="bd-highlight">
                            <div type="button" style="width:250px;" class="text-center">
                                <div class="btn-primary p-2 rounded-right sub-menu" id="list-transaksi">Transaksi Terkahir</div>
                            </div>
                            <div type="button" style="width:250px;" class="text-center">
                                <div class="btn-outline-primary border p-2 rounded-right sub-menu" id="buat-transaksi">Buat Transaksi</div>
                            </div>
                        </div>
                        <div class="pr-2 pl-2 flex-fill bd-highlight">
                            ${res}
                        </div>
                    </div>
                `
            }
            return res;
        }

        function hapusSupplier(id){
            $("#supplier-"+id).parent().parent().html("");
            ipcRenderer.sendSync("hapus-supplier",{id});
        }


        function supplierRender(data){
            console.log(data)
            res=''
            loop=""
            for(obj of data.data){
                if(obj.utang === undefined){
                    obj.utang=0
                }
                if(obj.piutang === undefined){
                    obj.piutang=0
                }
                loop+=`
                    <tr class="text-center">
                        <td scope="row">${obj.id}</td>
                        <td>${obj.nama}</td>
                        <td>${obj.alamat}</td>
                        <td>${obj.kontak}</td>
                        <td class="bg-danger text-white text-center">Rp ${obj.utang.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")}</td>
                        <td class="bg-success text-white text-center">Rp ${obj.piutang.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")}</td>
                        <td>
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#edit-utang-piutang-${obj.id}">Edit</button>
                            <div class="modal fade" id="edit-utang-piutang-${obj.id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Tambah Data Supplier</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div class="form-group">
                                            <h5>Utang : </h5>
                                            <input type="text" class="form-control" value="${obj.utang}" id="nama-supplier" aria-describedby="emailHelp" placeholder="Nama supplier">
                                        </div>
                                        <div class="form-group">
                                            <h5>Piutang : </h5>
                                            <input type="text" class="form-control" value="${obj.piutang}" id="alamat-supplier" aria-describedby="emailHelp" placeholder="Alamat supplier">
                                        </div>
                                        <button type="submit" class="btn btn-primary edit-utang-piutang" id_value=${obj.id}>Edit</button>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                                </div>
                                </div>
                            </div>
                            </div>
                        </td>
                        <td>
                            <button type="button" class="btn btn-danger" id="supplier-${obj.id}" onclick="hapusSupplier(${obj.id})">Hapus</button>
                        </td>
                    </tr>
                `
            }
            res+=`<table class="table">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Nama Supplier</th>
                        <th scope="col">Alamat</th>
                        <th scope="col">Kontak</th>
                        <th scope="col">Utang</th>
                        <th scope="col">Piutang</th>
                        <th scope="col">Edit Utang/Piutang</th>
                        <th scope="col">Hapus</th>
                    </tr>
                </thead>
                <tbody>${loop}</tbody>
                </table>
                `
            res=`
                <div class="input-group mb-2 p-2">
                    <input type="text" id="cari-supplier" class="form-control" placeholder="Masukkan nama toko supplier .." aria-label="Recipient's username" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                        <button class="btn btn-outline-info" type="button" id="cari-supplier-submit">Cari</button>
                    </div>
                </div>
                <div class="container mb-2 text-center">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#tambah-supplier">Tambah Supplier</button>
                    <div class="modal fade" id="tambah-supplier" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Tambah Data Supplier</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group">
                                    <input type="text" class="form-control" id="nama-supplier" aria-describedby="emailHelp" placeholder="Nama supplier">
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" id="alamat-supplier" aria-describedby="emailHelp" placeholder="Alamat supplier">
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" id="kontak-supplier" aria-describedby="emailHelp" placeholder="Kontak supplier">
                                </div>
                                <button type="submit" class="btn btn-primary" id="submit-buat-supplier">Buat</button>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                        </div>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="d-flex bd-highlight">
                    <div class="pr-2 pl-2 flex-fill bd-highlight">
                        ${res}
                    </div>
                </div>
            `
            return res;
        }

        function getHargaGrosir(){
            var semuaGrosir=ipcRenderer.sendSync("semua-grosir");
            return semuaGrosir.data;
        }

        function renderPilihanGrosir(){
            var grosir=getHargaGrosir();
            var pilihanGrosir="";
            for(gros of grosir){
                pilihanGrosir+=`<button type="button" class="dropdown-item" idbarang=${gros.id}>${gros.nama_jenis}</button>`
            }
            var element=`
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    jenis grosir
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    ${pilihanGrosir}
                </div>
            </div>
            `
            return element;
        }

        function renderTambahHargaGrosir(){
            var pilihanGrosir=renderPilihanGrosir();
            element=`
                <div class="container p-1 row tambah-grosir-input">
                    <div class="col-sm-4">${pilihanGrosir}</div>
                    <div class="col-sm-4">
                        <div>
                            <div>
                                <input class="form-control tambah-grosir-minimum-pembelian" type="text" placeholder="Minimum Pembelian"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div>
                            <div>
                                <input class="form-control tambah-grosir-harga-grosir" type="number" placeholder="harga grosir"/>
                            </div>
                        </div>
                    </div>
                </div>
            `
            return element;
        }

        $(".hapus-harga-grosir").click(ev=>{
            console.log(ev.target);
        });

        function barangRender(data,search){
            res=''
            loop=""
            console.log(data);
            for(obj of data.data){
                grosirs='';
                editElements='';
                for(grosir in obj.grosir){
                    if(grosir == "null"){
                        grosirs="<h4>Produk ini tidak dijual dengan harga grosir</h4>"
                        break;
                    }
                    var quantity='';
                    var editElement='';
                    for(quan of obj.grosir[grosir]){
                        console.log(quan)
                        harga_total=quan.kuantitas*quan.harga_satuan
                        quantity+=`
                            <tr>
                                <td>${quan.kuantitas}</td>
                                <td>${quan.harga_satuan == null?quan.harga_satuan:quan.harga_satuan.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")}</td>
                                <td>${harga_total.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")}</td>
                            </tr>
                        `
                        editElement+=`
                            <tr>
                                <td id="grosir-${quan.grosir_id}">${quan.nama_grosir}</td>
                                <td>
                                    <input type="number" class="form-control" value=${quan.kuantitas} id="kuantitas-${obj.id}" aria-describedby="emailHelp">
                                </td>
                                <td>    
                                    <input type="number" class="form-control" value=${quan.harga_satuan} id="harga-satuan-${obj.id}" aria-describedby="emailHelp" placeholder="Nama produk">
                                </td>
                                <td>
                                    <button type="button" class="btn btn-danger hapus-harga-grosir" >Hapus</button>
                                </td>
                            </tr>
                        `
                    }
                    grosirs+=`
                    <div class="container">
                        <small class="text-center font-weight-bold">${grosir} :</small>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Kuantitas</th>
                                    <th scope="col">Harga Satuan</th>
                                    <th scope="col">Total Harga</th>
                                </tr>
                            </thead>
                            <tbody>
                                    ${quantity}
                            </tbody>
                        </table>
                    </div>
                    `
                    editElements+=`
                    <div class="container" id_grosir="${quan.grosir_id}">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Nama Jenis</th>
                                    <th scope="col">Kuantitas</th>
                                    <th scope="col">Harga Satuan</th>
                                    <th scope="col">Hapus</th>
                                </tr>
                            </thead>
                            <tbody>
                                    ${editElement}
                            </tbody>
                        </table>
                    </div>
                    `
                }
                loop+=`
                    <tr>
                        <td>${obj.nama}</td>
                        <td>${obj.harga.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")}</td>
                        <td>${obj.kode_barang ?? ""}</td>
                        <td>
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-grosir-${obj.id}" data-whatever="${obj.id}">Lihat</button>
                            <div class="modal fade" id="modal-grosir-${obj.id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">${obj.nama}</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    ${grosirs}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                                </div>
                                </div>
                            </div>
                            </div>
                        </td>
                        <td>
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#edit-barang-${obj.id}" data-whatever="data">Edit</button>
                            <div class="modal fade" id="edit-barang-${obj.id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Tambahkan Produk</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div id="form-edit-barang">
                                            <div class="form-group">
                                                <input type="text" class="form-control" value="${obj.nama}" id="tambah-produk-nama-produk" aria-describedby="emailHelp" placeholder="Nama produk">
                                            </div>
                                            <div class="form-group">
                                                <input type="text" class="form-control" value="${obj.kode_barang ?? ''}" id="tambah-produk-kode-produk" aria-describedby="emailHelp" placeholder="Kode produk (opsional)">
                                            </div>
                                            <div class="form-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="basic-addon1">- Rp,</span>
                                                    <input type="number" class="form-control" value=${obj.harga} id="tambah-produk-harga-satuan" aria-describedby="emailHelp" placeholder="Harga satuan produk">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="basic-addon1">- Rp,</span>
                                                    <input type="number" class="form-control" value=${obj.harga_beli} id="tambah-produk-harga-beli" aria-describedby="emailHelp" placeholder="Harga beli satuan produk">
                                                </div>
                                            </div>
                                            <div id="form-edit-grosir-${obj.id}">
                                                ${editElements}
                                            </div>
                                            <div class="tambah-harga-grosir"></div>
                                        </div>
                                        <br/>
                                        <button type="submit" class="btn btn-primary tambah-edit-harga-grosir">Tambah Harga Grosir</button>
                                    </form>
                                </div>
                                <div class="modal-footer" id_barang=${obj.id}>
                                    <button type="submit" class="btn btn-success submit-edit-barang">Simpan Perubahan</button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Batalkan</button>
                                </div>
                                </div>
                            </div>
                            </div>
                        </td>
                        <td>
                            <button class="btn btn-danger hapus-produk" val="${obj.id}">Hapus</button>
                        </td>
                    </tr>
                `
            }
            res+=`
            <div class="input-group mb-3">
                <input type="text" id="cari-barang" class="form-control" placeholder="Masukkan nama produk .." aria-label="Recipient's username" aria-describedby="basic-addon2">
                <div class="input-group-append">
                    <button class="btn btn-outline-info" type="button" id="cari-barang-submit">Cari</button>
                </div>
            </div>
            <div class="container text-center mb-2">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#tambah-list-produk" data-whatever="data">Tambah Produk</button>
                            <div class="modal fade" id="tambah-list-produk" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Tambahkan Produk</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div id="form-tambah-list-barang">
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="tambah-produk-nama-produk" aria-describedby="emailHelp" placeholder="Nama produk">
                                            </div>
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="tambah-produk-kode-produk" aria-describedby="emailHelp" placeholder="Kode produk (opsional)">
                                            </div>
                                            <div class="form-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="basic-addon1">- Rp,</span>
                                                    <input type="number" class="form-control" id="tambah-produk-harga-satuan" aria-describedby="emailHelp" placeholder="Harga satuan produk">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="basic-addon1">- Rp,</span>
                                                    <input type="number" class="form-control" id="tambah-produk-harga-beli" aria-describedby="emailHelp" placeholder="Harga beli satuan produk">
                                                </div>
                                            </div>
                                            <div id="form-tambah-list-harga-grosir">
                                            </div>
                                        </div>
                                        <br/>
                                        <button type="submit" class="btn btn-primary" id="tambah-harga-grosir">Tambah Harga Grosir</button>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-success" id="submit-tambah-list-produk">Tambah Produk</button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                                </div>
                                </div>
                            </div>
                            </div>
                </div>

                <div class="container text-center mb-2">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#tambah-kategori-grosir" data-whatever="data">Tambah Kategori Grosir</button>
                            <div class="modal fade" id="tambah-kategori-grosir" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Tambahkan Kategori Grosir</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div id="form-tambah-list-barang">
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="tambah-kategori-grosir-value" aria-describedby="emailHelp" placeholder="Nama Jenis Grosir">
                                            </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-success" id="tambah-kategori-grosir-submit">Tambah Kategori Grosir</button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                                </div>
                                </div>
                            </div>
                            </div>
                </div>
            
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Nama Produk</th>
                        <th scope="col">Harga Satuan Rupiah</th>
                        <th scope="col">Kode Produk</th>
                        <th scope="col">Grosir</th>
                        <th scope="col">Edit</th>
                        <th scope="col">Hapus</th>
                    </tr>
                </thead>
                <tbody>${loop}</tbody>
                </table>
                `
            res=`
                <div class="d-flex bd-highlight">
                    <div class="pr-2 pl-2 flex-fill bd-highlight">
                        ${res}
                    </div>
                </div>
            `
            return res;
        }

        function tambahPelanggan(){
            const namaPelanggan=$("#tambah-pelanggan-nama").val();
            const alamatPelanggan=$("#tambah-pelanggan-alamat").val();
            const kontakPelanggan=$("#tambah-pelanggan-kontak").val();
            const data={
                "namaPelanggan":namaPelanggan,
                "alamatPelanggan":alamatPelanggan,
                "kontakPelanggan":kontakPelanggan
            }
            var resp=ipcRenderer.sendSync("tambah-pelanggan",data);
            if(resp.inserted){
                $('.modal-backdrop').remove();
                $("#tambah-pelanggan").modal("hide");
                renderContent("pelanggan");
            }
        }

        function pelangganRender(data){
            res=''
            loop=""
            for(obj of data.data){
                loop+=`
                    <tr>
                        <td scope="row">${obj.id}</td>
                        <td>${obj.nama}</td>
                        <td>${obj.alamat}</td>
                        <td>${obj.kontak}</td>
                    </tr>
                `
            }
            res+=`<table class="table">
                <thead>
                    <tr>
                        <th scope="col">id</th>
                        <th scope="col">name</th>
                        <th scope="col">alamat</th>
                        <th scope="col">Kontak</th>
                    </tr>
                </thead>
                <tbody>${loop}</tbody>
                </table>
                `
            res=`
            <div class="container text-center mb-2">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#tambah-pelanggan" data-whatever="data">Tambah Pelanggan</button>
                            <div class="modal fade" id="tambah-pelanggan" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Tambahkan Produk</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div id="form-tambah-pelanggan">
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="tambah-pelanggan-nama" aria-describedby="emailHelp" placeholder="Nama Pelanggan">
                                            </div>
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="tambah-pelanggan-alamat" aria-describedby="emailHelp" placeholder="Alamat Pelanggan">
                                            </div>
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="tambah-pelanggan-kontak" aria-describedby="emailHelp" placeholder="Kontak">
                                            </div>
                                        </div>
                                        <br/>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-success" onclick="tambahPelanggan()">Tambah Pelanggan</button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                                </div>
                                </div>
                            </div>
                            </div>
                </div>
                <div class="d-flex bd-highlight">
                    
                    <div class="pr-2 pl-2 flex-fill bd-highlight">
                        ${res}
                    </div>
                </div>
            `
            return res;
        }

        function pembelianRender(data){
            res=''
            loop=""
            for(obj of data.data){
                loop+=`
                    <tr>
                        <th scope="row">${obj.id}</th>
                        <td>${obj.name}</th>
                    </tr>
                `
            }
            res+=`<table class="table">
                <thead>
                    <tr>
                        <th scope="col">id</th>
                        <th scope="col">name</th>
                    </tr>
                </thead>
                <tbody>${loop}</tbody>
                </table>
                `
            res=`
                <div class="d-flex bd-highlight">
                    <div class="bd-highlight">
                        <div style="width:250px;" class="text-center">
                            <div class="btn-primary p-2 rounded-right sub-menu">Daftar Pembelian</div>
                        </div>
                        <div style="width:250px;" class="text-center">
                            <div class="btn-outline-primary border p-2 rounded-right sub-menu">Pertumbuhan Pembelian</div>
                        </div>
                    </div>
                    <div class="pr-2 pl-2 flex-fill bd-highlight">
                        ${res}
                    </div>
                </div>
            `
            return res;
        }

        function penjualanRender(data){
            var dataPenjualan=ipcRenderer.sendSync("penjualan-detail",{})
            console.log(dataPenjualan);
            var orderDay="";
            for(penjualan of dataPenjualan.data){

                var dataOrder="";
                for(order of penjualan.order){

                    var dataBarang="";
                    for(barang of order.barang){
                        var subTotal=barang.sub_total != null ? barang.sub_total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : ""
                        dataBarang+=`
                            <tr>
                                <td>${barang.nama_produk}</td>
                                <td>${barang.jenis_grosir}</td>
                                <td>${barang.kuantitas}</td>
                                <td>${subTotal}</td>
                            </tr>
                        `
                    }
                    var barangSiapRender=`
                        <table class="table">
                            <thead>
                                <th>Nama Produk</th>
                                <th>Jenis Pembelian</th>
                                <th>Kuantitas</th>
                                <th>Harga</th>
                            </thead>
                            <tbody>
                                ${dataBarang}
                            </tbody>
                        </table>
                    `
                    
                    var totalHarga=order.total_harga != null ? order.total_harga.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : "";
                    dataOrder+=`<tr>
                        <td>${order.order_id}</td>
                        <td>${totalHarga}</td>
                        <td>
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#history-produk-${order.order_id}">Detail</button>
                            <div class="modal fade" id="history-produk-${order.order_id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">ID Order : ${order.order_id}</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    ${barangSiapRender}
                                </div>
                                <div class="modal-footer">
                                    <h5 class="modal-title" id="exampleModalLabel">Total Harga : ${totalHarga}</h5>
                                    <button type="button" class="btn btn-secondary tutup-history-produk-modal">Tutup</button>
                                </div>
                                </div>
                            </div>
                            </div>
                        </td>
                    </tr>`
                }
                var orderRender=`
                    <table class="table">
                        <thead>
                            <th>ID Order</th>
                            <th>Total Transaksi</th>
                            <th>Detail Order</th>
                        </thead>
                        <tbody>
                            ${dataOrder}
                        </tbody>
                    </table>
                `

                orderDay+=`
                <tr>
                    <td>${penjualan.order_tahun}-${penjualan.order_bulan}-${penjualan.order_tanggal}</td>
                    <td scope="col">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#history-${penjualan.order_tahun}-${penjualan.order_bulan}-${penjualan.order_tanggal}">Detail</button>
                        <div class="modal fade" id="history-${penjualan.order_tahun}-${penjualan.order_bulan}-${penjualan.order_tanggal}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">${penjualan.order_tahun}-${penjualan.order_bulan}-${penjualan.order_tanggal}</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                ${orderRender}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                            </div>
                            </div>
                        </div>
                        </div>
                    </td>
                </tr>
                `
            }
            res=''
            res=`
                <div class="d-flex bd-highlight">
                    <div class="pr-2 pl-2 flex-fill bd-highlight">
                        <canvas id="penjualanChart" width="100%" height="50vh"></canvas>
                    </div>
                </div>
                <div>
                    <table class="table">
                        <thead>
                            <tr>
                                <td scope="col">Tanggal Penjualan (Tahun - Bulan - Tanggal)</td>
                                <td scope="col">Lihat Detail</td>
                            </tr>
                        </thead>
                        <tbody>
                                ${orderDay}
                        </tbody>
                    </table>
                </div>
            `
            return res;
        }

        function renderContent(content){
            // console.log(params);
            resp=ipcRenderer.sendSync(content,params??{});
            if(content === "menu-utama"){
                contentRender=menuUtamaRender(resp);
            } else if(content === "supplier"){
                resp=ipcRenderer.sendSync(content,supplierParams??{});
                contentRender=supplierRender(resp);
            } else if(content === "barang"){
                contentRender=barangRender(resp,{});
            } else if(content === "pelanggan"){
                contentRender=pelangganRender(resp);
            } else if(content === "pembelian"){
                contentRender=pembelianRender(resp);
            } else if(content === "penjualan"){
                contentRender=penjualanRender(resp);
            }
            contentData=resp;
            $("#content").html(contentRender);
            renderUlang(content);
        }
        renderContent(content)

    </script>
</body>
</html>